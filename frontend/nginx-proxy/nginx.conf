events {
    worker_connections 1024;
}

http {
    upstream admin-backend {
        server admin-backend:8000;
    }

    upstream order-backend {
        server order-backend:8000;
    }

    upstream courier-backend {
        server courier-backend:8000;
    }

    server {
        listen 80;
        server_name localhost;

        # Admin frontend
        location /admin {
            proxy_pass http://admin-frontend:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Admin API
        location /admin/api {
            proxy_pass http://admin-backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Order frontend
        location /order {
            proxy_pass http://order-frontend:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Order API
        location /order/api {
            proxy_pass http://order-backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Courier frontend
        location /courier {
            proxy_pass http://courier-frontend:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Courier API
        location /courier/api {
            proxy_pass http://courier-backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Root redirect
        location / {
            return 302 /admin;
        }
    }
}

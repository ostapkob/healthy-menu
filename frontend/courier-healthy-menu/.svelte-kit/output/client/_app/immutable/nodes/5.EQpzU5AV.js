import{f as x,a as _,c as j}from"../chunks/Dexp1yiY.js";import"../chunks/ifL9KKwh.js";import{o as C,a as J}from"../chunks/D70PosjZ.js";import{p as $,c as l,r as m,s as v,t as T,X as b,_ as g,a as k,f as y,b as O,m as A,g as f}from"../chunks/sF-5qWL7.js";import{e as D,i as M}from"../chunks/D-PWps5L.js";import{i as P}from"../chunks/DP6b_pEU.js";import{i as S}from"../chunks/Ykzsoriz.js";import{s as w,e as W}from"../chunks/DkO8GDoS.js";import{p as X,s as q,a as z}from"../chunks/mjQeaoyB.js";import{w as B}from"../chunks/C7ffHk-_.js";const E=B(1);var F=x('<div class="border p-4 mb-2 rounded"><p> </p> <p> </p> <p> </p> <button class="bg-green-500 text-white px-2 py-1">Принять</button></div>');function G(u,c){$(c,!1);const o=()=>z(E,"$courierId",s),[s,d]=q();let e=X(c,"order",8);const h=async()=>{(await fetch("http://localhost:8003/assign-delivery/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courier_id:o(),order_id:e().id})})).ok?(alert("Заказ принят"),window.location.reload()):alert("Ошибка при принятии заказа")};S();var i=F(),t=l(i),a=l(t);m(t);var r=v(t,2),n=l(r);m(r);var p=v(r,2),I=l(p);m(p);var N=v(p,2);m(i),T(()=>{w(a,`Заказ #${g(e()),b(()=>e().id)??""}`),w(n,`Цена: ${g(e()),b(()=>e().total_price)??""} ₽`),w(I,`Статус: ${g(e()),b(()=>e().status)??""}`)}),W("click",N,h),_(u,i),k(),d()}var H=x("<p>Нет доступных заказов</p>"),K=x('<h2 class="text-xl font-bold mb-4">Доступные заказы</h2> <!>',1);function ot(u,c){$(c,!1);let o=A([]),s=null;C(async()=>{const t=await fetch("http://localhost:8003/available-orders/");O(o,await t.json()),s=new WebSocket("ws://localhost:8003/ws/1"),s.onmessage=a=>{const r=JSON.parse(a.data);if(r.type==="new_order"){const n={id:r.order_id,total_price:"N/A",status:"pending"};O(o,[n,...f(o)])}}}),J(()=>{s&&s.close()}),S();var d=K(),e=v(y(d),2);{var h=t=>{var a=j(),r=y(a);D(r,1,()=>f(o),M,(n,p)=>{G(n,{get order(){return f(p)}})}),_(t,a)},i=t=>{var a=H();_(t,a)};P(e,t=>{f(o).length>0?t(h):t(i,!1)})}_(u,d),k()}export{ot as component};
